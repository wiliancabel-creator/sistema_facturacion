{% extends 'base.html' %}
{% block title %}Factura T√©rmica{% endblock %}
{% block content %}

<style>
#ticket {
  max-width: 320px;
  margin: auto;
  font-family: monospace;
  background: #fff;
  color: #000;
  padding: 8px;
  border: 1px solid #ccc;
}

/* Modo oscuro */
body.dark-mode #ticket {
  background: #1a1a1a;
  color: #f0f0f0;
  border-color: #555;
}

.center { text-align: center; }
.right  { text-align: right; }
hr { border: 0; border-bottom: 1px dashed #999; margin: 6px 0; }

/* TABLA DETALLE */
.detalle-tabla {
  width: 100%;
  font-size: 12px;
  margin-top: 3px;
}

.detalle-tabla th {
  border-bottom: 1px dashed #999;
  padding-bottom: 2px;
}

.detalle-tabla td {
  padding: 2px 0;
}

/* Ocultar al imprimir */
@media print {
  #btn-print { display: none; }
}
</style>

<div id="ticket">

  <!-- ENCABEZADO DEL NEGOCIO -->
  <div class="center">
    <strong>{{ empresa.nombre }}</strong><br>
    RTN: {{ empresa.rtn }}<br>
    {{ empresa.direccion }}<br>
    Tel: {{ empresa.telefono }}<br>
    {{ empresa.correo }}
  </div>

  <hr>

  <!-- NUMERO DE FACTURA -->
  <strong>Factura N¬∞:</strong>
  {{ venta.numero_factura }}<br>

  <!-- CAI Y RANGOS -->
  <strong>CAI:</strong>
  {% if venta.cai %}{{ venta.cai.codigo }}{% else %}SIN CAI{% endif %}<br>

  {% if venta.cai %}
      <strong>Rango:</strong>
      {{ venta.cai.prefijo }}{{ venta.cai.rango_inicial|stringformat:"08d" }}
      a
      {{ venta.cai.prefijo }}{{ venta.cai.rango_final|stringformat:"08d" }}<br>

      <strong>V√°lido hasta:</strong> {{ venta.cai.fecha_limite|date:"d/m/Y" }}<br>
  {% endif %}

  <strong>Fecha:</strong> {{ venta.fecha|date:"d/m/Y H:i" }}<br>
  <strong>Pago:</strong> {{ venta.tipo_pago|title }}<br>

  <hr>

  <!-- DATOS DEL CLIENTE -->
  <strong>Cliente:</strong> {{ venta.cliente.nombre }}<br>
  {% if venta.cliente.rtn %}<strong>RTN:</strong> {{ venta.cliente.rtn }}<br>{% endif %}
  {% if venta.cliente.direccion %}<strong>Direcci√≥n:</strong> {{ venta.cliente.direccion }}<br>{% endif %}
  {% if venta.cliente.telefono %}<strong>Tel:</strong> {{ venta.cliente.telefono }}<br>{% endif %}

  <hr>

  <strong>Detalle:</strong><br>

  {% for item in detalles %}

    <div style="font-weight:bold; margin-top:6px;">
      {{ item.producto.nombre }}
    </div>

    <table class="detalle-tabla">
      <thead>
        <tr>
          <th>Cant</th>
          <th>Precio</th>
          <th>Desc</th>
          <th>ISV</th>
          <th class="right">Subt</th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td>{{ item.cantidad }}</td>
          <td>{{ item.precio_unitario }}</td>
          <td>{{ item.descuento }}%</td>
          <td>
            {% if item.producto.tipo_impuesto == 'G15' %}15%
            {% elif item.producto.tipo_impuesto == 'G18' %}18%
            {% else %}0%
            {% endif %}
          </td>
          <td class="right">L {{ item.total_linea }}</td>
        </tr>
      </tbody>
    </table>

    <hr>

  {% endfor %}

  <!-- TOTALES FISCALES -->
  <strong>Totales:</strong><br>
  Exento: L {{ venta.subtotal_exento }}<br>
  Gravado 15%: L {{ venta.subtotal_g15 }}<br>
  Gravado 18%: L {{ venta.subtotal_g18 }}<br>
  ISV 15%: L {{ venta.impuesto_15 }}<br>
  ISV 18%: L {{ venta.impuesto_18 }}<br>
  <hr>

  <strong>Total a pagar: L {{ venta.total }}</strong>

  <hr>

  <strong>Son:</strong><br>
  {{ total_letras }}

  <br><br>
  <div class="center">
    ------------------------------<br>
    Firma del cliente
  </div>

</div>

<div class="text-center mt-3">
  <button id="btn-print" class="btn btn-primary" onclick="window.print()">
    üñ®Ô∏è Imprimir
  </button>
</div>

{% endblock %}






