{% extends 'base.html' %}
{% block title %}Resumen de Cuentas{% endblock %}
{% block content %}



<!-- Único filtro para ambos módulos -->
<form method="get" class="row g-3 mb-4">
  <div class="col-auto">
    <select name="estado" class="form-select">
      <option value="" {% if not estado_seleccionado %}selected{% endif %}>Todos</option>
      <option value="pendiente" {% if estado_seleccionado == 'pendiente' %}selected{% endif %}>Pendiente</option>
      <option value="pagado" {% if estado_seleccionado == 'pagado' %}selected{% endif %}>Pagado</option>
    </select>
  </div>
  <div class="col-auto">
    <button type="submit" class="btn btn-primary">Filtrar</button>
  </div>
</form>

<h2>Cuentas por Cobrar</h2>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Cliente</th>
      <th>Monto Original</th>
      <th>Monto Pagado</th>
      <th>Saldo Restante</th>
      <th>Vence</th>
      <th>Estado</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for cuenta in por_cobrar %}
    <tr>
      <td>{{ cuenta.cliente.nombre }}</td>
      <td>L {{ cuenta.monto_pendiente|floatformat:2 }}</td>
      <td>L {{ cuenta.monto_pagado|floatformat:2 }}</td>
      <td>
        <strong>L {{ cuenta.saldo_restante|floatformat:2 }}</strong>
      </td>
      <td>{{ cuenta.fecha_vencimiento|date:"M d, Y" }}</td>
      <td>
        {% if cuenta.estado == 'pendiente' %}
          <span class="badge bg-warning text-dark">Pendiente</span>
        {% else %}
          <span class="badge bg-success">Pagado</span>
        {% endif %}
      </td>
      <td>
        <a href="{% url 'factura' cuenta.venta.id %}" class="btn btn-sm btn-outline-primary">Ver Factura</a>
        {% if cuenta.estado == 'pendiente' %}
        <a href="{% url 'registrar_pago_cliente' cuenta.id %}" class="btn btn-sm btn-success">Registrar Pago</a>
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="7">No hay cuentas por cobrar.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h2>Cuentas por Pagar</h2>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Proveedor</th>
      <th>Monto Original</th>
      <th>Monto Pagado</th>
      <th>Saldo Restante</th>
      <th>Vence</th>
      <th>Estado</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for cuenta in por_pagar %}
    <tr>
      <td>{{ cuenta.proveedor.nombre }}</td>
      <td>L {{ cuenta.monto_pendiente|floatformat:2 }}</td>
      <td>L {{ cuenta.monto_pagado|floatformat:2 }}</td>
      <td>
        <strong>L {{ cuenta.saldo_restante|floatformat:2 }}</strong>
      </td>
      <td>{{ cuenta.fecha_vencimiento|date:"M d, Y" }}</td>
      <td>
        {% if cuenta.estado == 'pendiente' %}
          <span class="badge bg-warning text-dark">Pendiente</span>
        {% else %}
          <span class="badge bg-success">Pagado</span>
        {% endif %}
      </td>
      <td>
        <a href="{% url 'resumen_compra' cuenta.compra.id %}" class="btn btn-sm btn-outline-success">Ver Resumen</a>
        {% if cuenta.estado == 'pendiente' %}
        <a href="{% url 'registrar_pago_proveedor' cuenta.id %}" class="btn btn-sm btn-success">Registrar Pago</a>
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="7">No hay cuentas por pagar.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
