{% extends "base.html" %}
{% block content %}
<div class="container mt-3">
  <div class="d-flex justify-content-between align-items-center">
    <div>
      <h4>ðŸŸ¢ Caja Abierta</h4>
      <div class="text-muted">
        <strong>Caja:</strong> {{ sesion.caja.nombre }} |
        <strong>Cajero:</strong> {{ sesion.cajero }} |
        <strong>Apertura:</strong> {{ sesion.fecha_apertura|date:"Y-m-d H:i" }}
      </div>
    </div>
    <div>
      <a class="btn btn-warning" href="{% url 'caja:cerrar_caja' sesion.id %}">Cerrar Caja</a>
    </div>
  </div>

  <div class="row mt-3">
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h6 class="mb-2">ðŸ“Š Totales del sistema (Pagos)</h6>
          <div class="d-flex justify-content-between"><span>Efectivo</span><strong>L {{ tot_pagos.efectivo|default:"0.00" }}</strong></div>
          <div class="d-flex justify-content-between"><span>Tarjeta</span><strong>L {{ tot_pagos.tarjeta|default:"0.00" }}</strong></div>
          <div class="d-flex justify-content-between"><span>Transferencia</span><strong>L {{ tot_pagos.transferencia|default:"0.00" }}</strong></div>

          <hr>
          <div class="d-flex justify-content-between"><span>Ingresos manuales</span><strong>L {{ ingresos }}</strong></div>
          <div class="d-flex justify-content-between"><span>Egresos manuales</span><strong>L {{ egresos }}</strong></div>

          <hr>
          <div class="d-flex justify-content-between"><span>Monto apertura</span><strong>L {{ sesion.monto_apertura }}</strong></div>
          <div class="d-flex justify-content-between"><span>Efectivo teÃ³rico</span><strong>L {{ efectivo_teorico }}</strong></div>
        </div>
      </div>
    </div>

    <div class="col-md-6 mt-3 mt-md-0">
      <div class="card">
        <div class="card-body">
          <h6 class="mb-2">âž•âž– Registrar movimiento</h6>
          <form method="post">
            {% csrf_token %}
            <input type="hidden" name="accion" value="movimiento">

            <div class="row g-2">
              <div class="col-4">
                <select name="tipo" class="form-control" required>
                  <option value="ingreso">Ingreso</option>
                  <option value="egreso">Egreso</option>
                </select>
              </div>
              <div class="col-8">
                <input type="text" name="concepto" class="form-control" placeholder="Concepto" required>
              </div>
              <div class="col-12">
                <input type="number" step="0.01" name="monto" class="form-control" placeholder="Monto" required>
              </div>
            </div>

            <button class="btn btn-success mt-2 w-100">Guardar movimiento</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="card mt-3">
    <div class="card-body">
      <h6 class="mb-2">ðŸ“ƒ Ãšltimos movimientos</h6>
      <div class="table-responsive">
        <table class="table table-sm table-striped">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Tipo</th>
              <th>Concepto</th>
              <th class="text-end">Monto</th>
            </tr>
          </thead>
          <tbody>
          {% for m in movimientos %}
            <tr>
              <td>{{ m.fecha|date:"Y-m-d H:i" }}</td>
              <td>{{ m.get_tipo_display }}</td>
              <td>{{ m.concepto }}</td>
              <td class="text-end">L {{ m.monto }}</td>
            </tr>
          {% empty %}
            <tr><td colspan="4" class="text-center text-muted">Sin movimientos</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
